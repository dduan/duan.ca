<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Daniel Duan">
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://duan.ca/2013/05/28/sencha-touch-2-and-phonegap-integration/">
    <meta property="og:site_name" content="Daniel Duan's Website">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Sencha Touch 2 and PhoneGap integration">
    <meta property="article:published_time" content="2013-05-28T15:24:30-06:00"><meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@daniel_duan">
    <meta name="twitter:creator" content="@daniel_duan">
    <meta name="apple-mobile-web-app-title" content="Daniel Duan">
    <title>Sencha Touch 2 and PhoneGap integration</title>
    <link rel="alternate" type="application/rss+xml" title="Daniel Duan's Website" href="/feed.xml">
    <link rel="canonical" href="https://duan.ca/2013/05/28/sencha-touch-2-and-phonegap-integration/">
    <link rel="stylesheet" href="/styles.css">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/dduan.svg" type="image/svg+xml">
</head>
<body><article itemscope itemtype="https://schema.org/Article">
    <meta itemprop="headline" content="Sencha Touch 2 and PhoneGap integration">
    <meta itemprop="datePublished" content="2013-05-28T15:24:30-06:00">
    <meta itemprop="dateModified" content="2013-05-28T15:24:30-06:00">
    <link itemprop="url" href="https://duan.ca/2013/05/28/sencha-touch-2-and-phonegap-integration/">
    <link itemprop="mainEntityOfPage" href="https://duan.ca/2013/05/28/sencha-touch-2-and-phonegap-integration/">
    <div itemprop="author" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="Daniel Duan">
        <link itemprop="url" href="https://duan.ca/">
    </div>
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="Daniel Duan">
        <link itemprop="url" href="https://duan.ca/">
    </div>
    <meta itemprop="keywords" content="Sencha Touch">
    <meta itemprop="keywords" content="PhoneGap">
    <meta itemprop="keywords" content="Cordova">
    <h1>Sencha Touch 2 and PhoneGap integration</h1>
    <nav>
        <p class="metainfo article-meta">
            <a href="/articles/">Daniel Duan</a>
            路
            <time datetime="2013-05-28T15:24:30-06:00">2013-05-28</time>
        </p>
    </nav>
    <div itemprop="articleBody"><p>As one of my pet Sencha Touch project gets close to finish, I started
looking into distribute it as native apps with Phonegap/Cordova.</p>
<p>One of the concerns in do so is the 'deviceready' event provided by Phonegap,
according to the documentation:</p>
<blockquote>
<p>This is a very important event that every Cordova application should use.<br />
...</p>
</blockquote>
<blockquote>
<p>The Cordova deviceready event fires once Cordova has fully loaded.
After the device has fired, you can safely make calls to Cordova function.</p>
<p>Typically, you will want to attach an event listener with
document.addEventListener once the HTML document's DOM has loaded.</p>
</blockquote>
<p>In particular, the nice Sencha Touch microloader complicate the matter by
being the sole Javascript file that's supposed to be included in <code>index.html</code>
and is in charge of starting the actual code of our apps. Yet we need the
starting point of the code be a response to the <code>deviceready</code> event.</p>
<p>After some googling, I found that most information on this matter is either
inaccurate, incomplete or outdated, that is until I found <a href="http://stackoverflow.com/a/10457158/243798">this answer</a> by
<a href="http://dougan.me">Robert Dougan</a> on StackOverflow:</p>
<blockquote>
<p>Sencha Touch 2 will listen to that event and call your onReady/launch methods</p>
<ul>
<li>therefore if you try listening to them in the launch method,
it has already been fired.</li>
</ul>
<p>Just put your logic inside the launch method in your application.</p>
</blockquote>
<p>To verify this claim, I dug into <code>sencha-touch-debug.js</code> distributed with
Sencha Touch 2.2 and found the following code:</p>
<pre><code>if (Ext.browser.is.PhoneGap &amp;&amp; !Ext.os.is.Desktop) {
    if (!Ext.readyListenerAttached) {
        Ext.readyListenerAttached = true;
        document.addEventListener('deviceready', triggerFn, false);
    }
}
</code></pre>
<p>It appears that the <code>deviceready</code> event is taken into account here as long as
<code>Ext.browser.is.PhoneGap</code> is true in a mobile browser envronment, which, in the
same source code, means:</p>
<pre><code>if (typeof window.PhoneGap != 'undefined' ||
    typeof window.Cordova != 'undefined'  ||
    typeof window.cordova != 'undefined') {
    isWebView = true;
    this.setFlag('PhoneGap');
}
</code></pre>
<p>Here, the global variable PhoneGap, cordova or Cordova needs to be defined to
satisfy Sencha Touch 2's expectation of PhoneGap environment. Those globals
are defined in the <code>cordova-x.y.x.js</code> file included in the PhoneGap/Cordova
project files.</p>
<p>So what needs to be done for the integration is simple (if not clear):</p>
<p>include <code>cordova-x.y.x.js</code> in the js section of <code>app.json</code> project file so that
the microloader knows to load it up early:</p>
<pre><code>&quot;js&quot;: [
    {
        &quot;path&quot;: &quot;path/to/cordova-x.y.z.js&quot;,
    },
    {
        &quot;path&quot;: &quot;touch/sencha-touch.js&quot;,
        &quot;x-bootstrap&quot;: true
    },
    {
        &quot;path&quot;: &quot;app.js&quot;,
        &quot;bundle&quot;: true, 
        &quot;update&quot;: &quot;delta&quot;
    }
],
</code></pre>
<p>Run <code>sencha app build package</code> and drop the files it produces to the <code>www</code>
folder in the PhoneGap project.</p>
<p>Compile, ship.</p>
</div>
</article>
<footer>
    <hr />
    <p class="metainfo article-meta">
        <a href="/articles/">More Articles</a>
        路
        <a href="/tag/sencha-touch/">Sencha Touch</a>
        路
        <a href="/tag/phonegap/">PhoneGap</a>
        路
        <a href="/tag/cordova/">Cordova</a>
    </p>
</footer></body>
</html>