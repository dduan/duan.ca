<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Daniel Duan">
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://duan.ca/2015/07/12/swift-algebraic-data-types/">
    <meta property="og:site_name" content="Daniel Duan's Website">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Swift Algebraic Data Types">
    <meta property="article:published_time" content="2015-07-12T15:51:27.020057-07:00"><meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@daniel_duan">
    <meta name="twitter:creator" content="@Daniel Duan">
    <meta name="apple-mobile-web-app-title" content="Daniel Duan">
    <title>Swift Algebraic Data Types</title>
    <link rel="alternate" type="application/rss+xml" title="Daniel Duan's Website" href="/feed.xml">
    <link rel="canonical" href="https://duan.ca/2015/07/12/swift-algebraic-data-types/">
    <link rel="stylesheet" href="/styles.css"></link>
    <link rel="shortcut icon" href="/favicon.ico">
</head>
<body><article>
    <h1>Swift Algebraic Data Types</h1>
    <nav>
        <p class="metainfo article-meta">
            <a href="/articles">Daniel Duan</a>
            Â·
            <time datetime="2015-07-12T15:51:27.020057-07:00" itemProp="datePublished">2015-07-12</time>
        </p>
    </nav><h2>The Basics</h2>
<p><a href="https://en.wikipedia.org/wiki/Algebraic_data_type">Algebraic Data Type</a> is a fancy name for &quot;a type creaded by combining other
types&quot; in programming languages. One aspect of the &quot;algebraic-ness&quot; is how
many potential new values there are for the new type, given a set of type as
its building block.</p>
<p>To better illustrate this, consider the following example in Swift.</p>
<pre><code class="language-swift">enum StarkChild { case Rickon, Bran, Arya, Sansa, Robb, Jon }

enum Direwolf { case Shaggydog, Summer, Nymeria, Lady, Greywind, Ghost }

enum Actor {
    case Wolf(Direwolf)
    case Person(StarkChild)
}

struct Parters {
    var wolf: Direwolf
    var person: StarkChild
}
</code></pre>
<p><code>StarkChild</code> and <code>Direwolf</code> each has 6 potential values. Combining them, we
get two new types.</p>
<p>Question: how many potentiol values are there for <code>Actor</code>? How many for
<code>Parters</code>?</p>
<hr>
<p>An <code>Actor</code> can be either a <code>StarkChild</code> or a <code>DireWolf</code>, therefore it has `6</p>
<ul>
<li>6 = 12<code>potential values â€“ the *sum* of</code>Child<code>'s and </code>DireWolf`'s values.</li>
</ul>
<p>A <code>Partners</code> requires us to select one value from <code>Child</code> and one from
<code>DireWolf</code>, resulting in <code>6 * 6 = 36</code> potential values â€“ the <em>product</em> of
<code>Child</code>'s and <code>DireWolf</code>'s values.</p>
<p><code>Actor</code>, an <code>enum</code>, is a <em>sum</em> type. <code>Parters</code>, a <code>struct</code>, is a <em>product</em>
type. Here, <code>Parters</code> could easily be defined as a <code>class</code> or a <code>tuple</code> and
remain a <em>product</em> type. Because we can create product or sum types in these
direct ways, we can say Swift has first class support for Algebraic Data
Types.</p>
<h2>The Crossovers</h2>
<p>However, the story doesn't stop here. In Swift, an <code>enum</code>'s option can have
multiple values. If it happens to be the only option, then this
<code>enum</code>effectively becomes a <em>product</em> type:</p>
<pre><code class="language-swift">// there are 6 * 6 = 36 potential values for Parters
enum Parters {
    case Value(wolf: DireWolf, person: StarkChild)
}
</code></pre>
<p>Incidentally, this makes <code>enum</code> similar to <code>data</code> in Haskell, where <em>product</em>
and <em>sum</em> types can be created with a unified construct â€“ <code>data</code>.</p>
<p>In C and C++, <code>union</code>s are the closest thing to <em>sum</em> types. However, <code>union</code>
is hardly used to combine arbitrary types due to its lack of associated
values. What do people do in need of <em>sum</em> types? They make do with product
types. Here's one way to achive that in Swift:</p>
<pre><code class="language-swift">// Actor.value can have only 6 + 6 = 12 potential values thanks to
// manual enforcement
class Actor {
    var child: StarkChild?
    var wolf: Direwolf?

    var value: Any {
        get {
            return child == nil ? wolf! : child!
        }
        set(newValue) {
            if newValue is StarkChild {
                child = (newValue as! StarkChild)
                wolf = nil
            }
            if newValue is Direwolf {
                wolf = (newValue as! Direwolf)
                child = nil
            }
        }
    }

    init(wolf: Direwolf) {
        self.wolf = wolf
    }
    init(child: StarkChild) {
        self.child = child
    }
    init() {
        fatalError(&quot;must initialize with a child or a wolf&quot;)
    }
}
</code></pre>
<p>It'sâ€¦ ugly.</p>
<h2>Recursion Types</h2>
<p>Besides <em>sum</em> and <em>product</em>, another common class of algebraic type is
recursion types. The interesting bit here is that Swift struggles to support
it. In WWDC 2015, it was announced that <code>enum</code>s can be defined recursively in
Swift 2:</p>
<pre><code class="language-swift">enum Tree {
    case Empty
    indirect case Node(Tree, Tree)
}
</code></pre>
<p>As of this writing, Xcode 7 beta 3 has not delivered this feature yet.
Also, it's a good bet that <code>indirect</code> is not going to be available in tuple
aliases, such as:</p>
<pre><code class="language-swift">typealias Node = (indirect Node, indirect Node)
</code></pre>
<p>I hope this is on the Swift team's (understandably) gigantic todo list ðŸ˜‰.</p>

</article>
<footer>
    <hr />
    <p class="metainfo article-meta">
        <a href="/articles/">More Articles</a>
        Â·
        <a href="/tag/swift/">Swift</a>
    </p>
</footer></body>
</html>