<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Daniel Duan">
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://duan.ca/2017/05/22/build-in-swift-compatibility-mode/">
    <meta property="og:site_name" content="Daniel Duan's Website">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Building Swift Projects In Source Compatibility Mode">
    <meta property="article:published_time" content="2017-05-22T09:04:01-07:00"><meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@daniel_duan">
    <meta name="twitter:creator" content="@daniel_duan">
    <meta name="apple-mobile-web-app-title" content="Daniel Duan">
    <title>Building Swift Projects In Source Compatibility Mode</title>
    <link rel="alternate" type="application/rss+xml" title="Daniel Duan's Website" href="/feed.xml">
    <link rel="canonical" href="https://duan.ca/2017/05/22/build-in-swift-compatibility-mode/">
    <link rel="stylesheet" href="/styles.css">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/dduan.svg" type="image/svg+xml">
</head>
<body><article itemscope itemtype="https://schema.org/Article">
    <meta itemprop="headline" content="Building Swift Projects In Source Compatibility Mode">
    <meta itemprop="datePublished" content="2017-05-22T09:04:01-07:00">
    <meta itemprop="dateModified" content="2017-05-22T09:04:01-07:00">
    <link itemprop="url" href="https://duan.ca/2017/05/22/build-in-swift-compatibility-mode/">
    <link itemprop="mainEntityOfPage" href="https://duan.ca/2017/05/22/build-in-swift-compatibility-mode/">
    <div itemprop="author" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="Daniel Duan">
        <link itemprop="url" href="https://duan.ca/">
    </div>
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="Daniel Duan">
        <link itemprop="url" href="https://duan.ca/">
    </div>
    <meta itemprop="keywords" content="Swift">
    <meta itemprop="keywords" content="Xcode">
    <h1>Building Swift Projects In Source Compatibility Mode</h1>
    <nav>
        <p class="metainfo article-meta">
            <a href="/articles/">Daniel Duan</a>
            Â·
            <time datetime="2017-05-22T09:04:01-07:00">2017-05-22</time>
        </p>
    </nav>
    <div itemprop="articleBody"><p>It's a few weeks before WWDC, so naturallyÂ¹ it's time to try build your Swift
projects in the compiler's compatibility mode!</p>
<ol>
<li>
<p>Download and install a snapshot for the next major version <a href="https://swift.org/download/">on
Swift.org</a>.</p>
<p><img src="/assets/2017/05/download-swift-snapshot.png" alt="download swift toolchain" />
<img src="/assets/2017/05/install-swift-snapshot.png" alt="install swift toolchain" /></p>
</li>
<li>
<p>Choose the newly installed toolchain in Xcode.</p>
<p><img src="/assets/2017/05/choose-toolchain.png" alt="choose swift toolchain in Xcode" /></p>
</li>
<li>
<p>Ask the compiler to use compatibility mode. This means using the complier
flag <code>-swift-version X</code>, where &quot;X&quot; is the <em>current</em> major Swift version.</p>
<p>In project's &quot;Build Settings&quot;, value for &quot;Other Swift Flags&quot; should
contain <code>-swift-version X</code>. This could mean setting it in Xcode, in
<code>.xcconfig</code> files you are using and/or in your dependency managers such
as Cocoapods.</p>
<p><img src="/assets/2017/05/compat-mode-flag.png" alt="compatibility flag in xcode" /></p>
<p>For example, with Cocoapods, you'll need to add the following in your
<code>Podfile</code> to compile 3rd party libraries in compatibility mode:</p>
<pre><code> post_install do |installer|
     installer.pods_projects.targets.each do |target|
         target.build_configurations.each do |config|
             config.build_settings[&quot;OTHER_SWIFT_FLAGS&quot;] = &quot;$(inherited) -swift-version 3&quot;
         end
     end
 end
</code></pre>
</li>
<li>
<p>Build your project! This is where things start to get exciting.</p>
<p>You should expect some warnings. Hopefully they are self-explanatory
enough. Most of them should correspond to <a href="https://apple.github.io/swift-evolution/">a swift-evolution
proposal</a>.</p>
<p>Improvement to the language or compiler usually means some of these
warnings tell you problems in your code that has been ignored by the
compiler previously. Fix them today!</p>
<p>The project should compile successfully in compatibility mode (despite
warnings). This where you can stop reading. Go celebrate with your
coworkers, friends, and family!</p>
<p>Things could go wrong for compiler snapshots, of course. Read on if see
errors or crashes (whaaaaat ðŸ˜¸).</p>
</li>
<li>
<p>It's time to tell the compiler team about the error or crash you encountered.</p>
<p>Reduce the error or crash to a state that your are comfortable reporting in
public. Then go to <a href="https://bugs.swift.org">bugs.swift.org</a> and file a JIRA
ticket describing the error or compiler crash.</p>
<p>During the process of code reduction you may find ways to work around the
compile error or crash. Make the changes for the workaround and repeat
steps 4-5. Maybe your project will compile this time.</p>
</li>
<li>
<p>The issue you discovered will be fixed in the official Swift release come
fall. You've ensured a smooth Swift upgrade for your project and contributed
to the Swift community ðŸŽ‰!</p>
</li>
</ol>
<hr />
<p>Â¹ source compatibility mode is a thing starting with Swift 4. As new
major version of Swift is released, code written in the previous version should
compile without change in compatibility mode.</p>
</div>
</article>
<footer>
    <hr />
    <p class="metainfo article-meta">
        <a href="/articles/">More Articles</a>
        Â·
        <a href="/tag/swift/">Swift</a>
        Â·
        <a href="/tag/xcode/">Xcode</a>
    </p>
</footer></body>
</html>