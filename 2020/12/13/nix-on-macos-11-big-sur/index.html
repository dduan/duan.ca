<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Daniel Duan">
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://duan.ca/2020/12/13/nix-on-macos-11-big-sur/">
    <meta property="og:site_name" content="Daniel Duan's Website">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Installing Nix on macOS 11 Big Sur">
    <meta property="article:published_time" content="2020-12-13"><meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@daniel_duan">
    <meta name="twitter:creator" content="@Daniel Duan">
    <meta name="apple-mobile-web-app-title" content="Daniel Duan">
    <title>Installing Nix on macOS 11 Big Sur</title>
    <link rel="alternate" type="application/rss+xml" title="Daniel Duan's Website" href="/feed.xml">
    <link rel="canonical" href="https://duan.ca/2020/12/13/nix-on-macos-11-big-sur/">
    <link rel="stylesheet" href="/styles.css"></link>
    <link rel="shortcut icon" href="/favicon.ico">
</head>
<body><article>
    <h1>Installing Nix on macOS 11 Big Sur</h1>
    <nav>
        <p class="metainfo article-meta">
            <a href="/">Daniel Duan</a>
            ·
            <time datetime="2020-12-13" itemProp="datePublished">2020-12-13</time>
        </p>
    </nav><p><em>Note: as of Feburary, 2022, the steps written below has been incorporated by the official Nix install script for macOS. This article is, therefore, obsolete.</em></p>
<p>Here are the steps for installing nix on macOS 11 Big Sur.</p>
<h3>Preparation</h3>
<p>Decide on which disk the nix store is to be installed. By end of this process, you'll have a disk
name like <code>disk4</code>.</p>
<p>Personally, I like looking it up in the Disk Utility app:</p>
<p><img src="/assets/2020/12/disk-utility.png" alt="Disk Utility" /></p>
<p>You can also use other methods, such us the <code>diskutil list</code> command.</p>
<p>Have this disk name ready.</p>
<h3>Installation</h3>
<h4>1. Create the path <code>/nix</code> the macOS way.</h4>
<p>Edit or create the file <code>/etc/synthetic.conf</code>, adding this line:</p>
<pre><code>nix
</code></pre>
<p>Reboot the Mac.</p>
<h4>2. Create a APFS volume for the nix store.</h4>
<pre><code>sudo diskutil apfs addVolume diskX APFS 'Nix Store' -mountpoint /nix
</code></pre>
<p>Make sure to replace <code>diskX</code> with the disk you identified in the preparation step.</p>
<h4>3. Mount the volume.</h4>
<p>Edit or create the file <code>/etc/fstab</code>, adding this line:</p>
<pre><code>LABEL=Nix\040Store /nix apfs rw,nobrowse
</code></pre>
<p>Reboot the Mac.</p>
<h4>4. Install Nix the &quot;normal&quot; way</h4>
<pre><code>sh &lt;(curl -L https://nixos.org/nix/install)
</code></pre>
<h4>5. You are done! Try it out. I ran this little <a href="https://nix.dev/tutorials/dev-environment.html">example</a> as a test and things appears to work as expected.</h4>
<h3>Bonus: using Nix in Fish shell</h3>
<p>As a fish user, I'm used to fixing things up myself since software from non-fish users usually
pretends fish doesn't exist. Anyways, in the final steps of its installation, Nix sets up a few
environment variables in a bash script. I've adapted these specifically for fish on macOS. Add these
to your config.fish:</p>
<pre><code>set -x NIX_PROFILES &quot;/nix/var/nix/profiles/default $HOME/.nix-profile&quot;
set -x NIX_SSL_CERT_FILE &quot;$HOME/.nix-profile/etc/ssl/certs/ca-bundle.crt&quot;
set -x NIX_PATH /nix $HOME/.nix-defexpr/channels
set -x PATH $HOME/.nix-profile/bin $PATH
</code></pre>
<p>It shouldn't be to hard to do this on other OSes. The relevant information is in
<code>~/.nix-profile/etc/profile.d/nix.sh</code>.</p>

</article>
<footer>
    <hr />
    <p class="metainfo article-meta">
        <a href="/articles/">More Articles</a>
        ·
        <a href="/tag/nix/">Nix</a>
        ·
        <a href="/tag/macos/">macOS</a>
    </p>
</footer></body>
</html>