<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Daniel Duan">
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://duan.ca/2022/03/15/standalone-home-manager-flake-channels/">
    <meta property="og:site_name" content="Daniel Duan's Website">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Flake, Home Manager, and Extra Packages">
    <meta property="article:published_time" content="2022-03-15T18:53:59-07:00"><meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@daniel_duan">
    <meta name="twitter:creator" content="@Daniel Duan">
    <meta name="apple-mobile-web-app-title" content="Daniel Duan">
    <title>Flake, Home Manager, and Extra Packages</title>
    <link rel="alternate" type="application/rss+xml" title="Daniel Duan's Website" href="/feed.xml">
    <link rel="canonical" href="https://duan.ca/2022/03/15/standalone-home-manager-flake-channels/">
    <link rel="stylesheet" href="/styles.css"></link>
    <link rel="shortcut icon" href="/favicon.ico">
</head>
<body><article>
    <h1>Flake, Home Manager, and Extra Packages</h1>
    <nav>
        <p class="metainfo article-meta">
            <a href="/articles">Daniel Duan</a>
            ·
            <time datetime="2022-03-15T18:53:59-07:00" itemProp="datePublished">2022-03-15</time>
        </p>
    </nav><p>So, you use a standalone home-manager, it's set up with flake, tracking a particular nixpkgs channel. How do
you use a package from another channel? This seemingly simple task took me, a Nix noob, quite a bit of
research to solve. Here's how I did it.</p>
<p>A simple flake.nix for home-manager might look like this:</p>
<pre><code class="language-nix">{
  inputs = {
    nixpkgs.url = &quot;github:nixos/nixpkgs/nixos-21.11&quot;;
    home-manager.url = &quot;github:nix-community/home-manager/release-21.11&quot;;
    home-manager.inputs.nixpkgs.follows = &quot;nixpkgs&quot;;
  };
  outputs = { self, nixpkgs, home-manager }: {
    &quot;dan@some-mac&quot; = home-manager.lib.homeManagerConfiguration {
      username = &quot;dan&quot;;
      system = &quot;x86_64-darwin&quot;;
      homeDirectory = &quot;/home/dan&quot;;
      configuration = { config, pkgs ... }: {
          home.packages = [
            pkgs.hello
          ];
      };
    };
  };
}
</code></pre>
<p>A few things of note:</p>
<ol>
<li>home manager is set to follow <code>nixpkgs</code>, which tracks <code>nixos-21.11</code>.</li>
<li><code>pkgs.hello</code> refers to the package in <code>nixos-21.11</code> as well.</li>
</ol>
<p>To put things in concrete terms, our goal is to put a package from a channel other than <code>nixos-21.11</code>
alongside <code>pkgs.hello</code>.</p>
<p>The key to my solution is the <code>extraModules</code> in <code>home-manager.lib.homeManagerConfiguration</code>'s argument set.
We'll leverage it to modify the environment made available to its sibling, <code>configuration</code>.</p>
<p>First, add the new channel as input <code>nixpkgs-unstable</code>:</p>
<pre><code class="language-nix">{
  inputs = {
    # ...
    nixpkgs-unstable.url = &quot;github:nixos/nixpkgs&quot;;
  };
  ...
}
</code></pre>
<p>Then, add a small module to <code>extraModules</code>. In it we make <code>nixpkgs-unstable</code> an argument to <code>_module</code>.</p>
<pre><code class="language-nix">{
  input = { ... };
  outputs = { self, nixpkgs, nixpkgs-unstable, home-manager }: { # Note we also pass in nixpkgs-unstable here
    &quot;dan@some-mac&quot; = home-manager.lib.homeManagerConfiguration {
      extraModules = [
        ({ pkgs, ... }: rec {
          _module.args.nixpkgs-unstable = import nixpkgs-unstable { inherit system; };
        })
      ];
      # ...
    };
  };
}
</code></pre>
<p>... now that we added <code>args.nixpkgs-unstable</code>, it becomes available in the configuration:</p>
<pre><code class="language-nix">{
  input = { ... };
  outputs = { self, nixpkgs, nixpkgs-unstable, home-manager }: { # Note we also pass in nixpkgs-unstable here
    &quot;dan@some-mac&quot; = home-manager.lib.homeManagerConfiguration {
      # ...
      configuration = { config, pkgs, nixpkgs-unstable, ... }:
          home.packages = [
            pkgs.hello
            nixpkgs-unstable.python39Packages.python-lsp-server
          ];
      };
    };
  };
}
</code></pre>
<p>There, we made <code>python39Packages.python-lsp-server</code> from nixpkgs's master branch appear alongside our
standard, default channel.</p>
<p>And that's how you add packages from a different channel in a flake setup for standalone home-manager.</p>

</article>
<footer>
    <hr />
    <p class="metainfo article-meta">
        <a href="/articles/">More Articles</a>
        ·
        <a href="/tag/nix/">Nix</a>
        ·
        <a href="/tag/nixpkgs/">Nixpkgs</a>
        ·
        <a href="/tag/home-manager/">home-manager</a>
        ·
        <a href="/tag/flake/">flake</a>
    </p>
</footer></body>
</html>