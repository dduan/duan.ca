<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Daniel Duan</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Daniel Duan" href="/feed.xml" />
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Daniel Duan | Daniel Duan thinks.</title>
<meta name="generator" content="Jekyll v3.6.2" />
<meta property="og:title" content="Daniel Duan" />
<meta name="author" content="Daniel Duan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Daniel Duan thinks." />
<meta property="og:description" content="Daniel Duan thinks." />
<link rel="canonical" href="https://duan.ca/" />
<meta property="og:url" content="https://duan.ca/" />
<meta property="og:site_name" content="Daniel Duan" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@daniel_duan" />
<meta name="twitter:creator" content="@Daniel Duan" />
<script type="application/ld+json">
{"name":"Daniel Duan","description":"Daniel Duan thinks.","author":{"@type":"Person","name":"Daniel Duan"},"@type":"WebSite","url":"https://duan.ca/","headline":"Daniel Duan","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title">
    <a href="/">Daniel Duan<span>&#39;s blog</span></a>
  </h1>
  <nav class="masthead-nav">
    
    <a href="/articles">articles</a>
    
    <a href="/links">Links</a>
    
    <a href="/projects">Projects</a>
    
    <a href="/about">About</a>
    
  </nav>
</header>
<div class="content page">
  <h3 class="page-title"></h3>
  


  
  <div class="content post">
    
    <h1 class="post-title"><a href="/2017/12/27/building-pwd-under-1-minute-in-swift/">Building 'pwd' Under 1 Minute In Swift</a></h1>
    
    <div class="post-date">
      
      <time>27 Dec 2017</time>
      
       |
      <div class="post-tags">
      
        <a href="/tag/swift">Swift</a>,
      
        <a href="/tag/unix">Unix</a>,
      
        <a href="/tag/c">C</a>,
      
        <a href="/tag/youtube">YouTube</a>,
      
        <a href="/tag/minute-swift">Minute Swift</a>
      
      </div>
      
    </div>
    <p>I guess I‚Äôm starting a series of minute-long videos. In this first video, I built <code class="highlighter-rouge">pwd</code> out of <code class="highlighter-rouge">getcwd</code>. The
code turned out shorter than I imagined (1 line). Which is a good demonstration of Swift‚Äôs great C-interop
capability.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/YR4MCcMnHrI" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen=""></iframe>

<p>Some details are lost in this video, however. For example, the fact that POSIX 1 standard actually say
<code class="highlighter-rouge">getcwd</code>‚Äôs 2nd argument being <code class="highlighter-rouge">0</code> is undefined. Luckily both macOS and Linux define it the way we want
(allocate as much memory as needed). Swift‚Äôs handling of <code class="highlighter-rouge">char *</code> aka <code class="highlighter-rouge">UnsafeMutablePointer&lt;CChar&gt;</code> in context
of a <code class="highlighter-rouge">var</code> array is also very cool.</p>

  </div>
  <hr />
  
  <div class="content post">
    
    <h1 class="post-title"><a href="/2017/12/23/contributing-to-open-source-foundation/">Contributing To Open-Source Swift</a></h1>
    
    <div class="post-date">
      
      <time>23 Dec 2017</time>
      
       |
      <div class="post-tags">
      
        <a href="/tag/swift">Swift</a>,
      
        <a href="/tag/foundation">Foundation</a>,
      
        <a href="/tag/youtube">YouTube</a>
      
      </div>
      
    </div>
    <p>I discover, report, fix and merge a bug in the open-source Foundation project. And why, yes, on YouTube.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/rwuj80W8TtI" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen=""></iframe>

<ul>
  <li>Pull request: <a href="https://github.com/apple/swift-corelibs-foundation/pull/1376">https://github.com/apple/swift-corelibs-foundation/pull/1376</a></li>
  <li>SR-6647: <a href="https://bugs.swift.org/browse/SR-6647">https://bugs.swift.org/browse/SR-6647</a></li>
</ul>

  </div>
  <hr />
  
  <div class="content post">
    
    <h1 class="post-title"><a href="/2017/12/20/smart-invert-support-for-you-app/">Smart Color Invert And Your iOS Apps</a></h1>
    
    <div class="post-date">
      
      <time>20 Dec 2017</time>
      
       |
      <div class="post-tags">
      
        <a href="/tag/ios">iOS</a>,
      
        <a href="/tag/accessibility">Accessibility</a>,
      
        <a href="/tag/interface-builder">Interface Builder</a>
      
      </div>
      
    </div>
    <ol>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#the-basics">The Basics</a></li>
  <li><a href="#compatibility-with-older-ios-versions">Compatibility with older iOS versions</a></li>
  <li><a href="#how-to-screenshot-with-inverted-color-settings">How to screenshot with inverted color settings</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ol>

<h2 id="introduction">Introduction</h2>

<p>Apple sneakily shipped a ‚Äúdark mode‚Äù in iOS 11, native apps looks <em>gorgeous</em> in this mode (especially on
iPhone X with it‚Äôs OLED display):</p>

<p><img src="/assets/2017/12/native-ios-apps-with-smart-invert.png" srcset="/assets/2017/12/native-ios-apps-with-smart-invert.png 2x" alt="iOS 11 apps in smart invert mode" /></p>

<p>To see it for yourself, go to <em>Settings -&gt; General -&gt; Accessibility Display Accommodations -&gt; Invert Colors</em>
and toggle the switch to on (I personally set triple tap of the power buttton to toggle this on/off):</p>

<p><img src="/assets/2017/12/invert-color-settings.png" alt="turn on smart invert mode in Settings" /></p>

<p>Note that in Apple‚Äôs first-party apps, not every view‚Äôs color is inverted (hence, ‚Äúsmart‚Äù). For apps that we
built, that would not be the case automatically. Instead, we get the full color inversion under this setting:</p>

<p><img src="/assets/2017/12/third-party-app-no-change.png" srcset="/assets/2017/12/third-party-app-no-change.png 2x" alt="default third party app before and after smart color" /></p>

<p>In this article, we‚Äôll see how to best adapt our apps so they look just as good as first-party iOS apps under
the smart invert setting.</p>

<h2 id="the-basics">The Basics</h2>

<p><em>TL;DR: use <a href="https://developer.apple.com/documentation/uikit/uiview/2865843-accessibilityignoresinvertcolors">accessibilityIgnoresInvertColors</a> on your <code class="highlighter-rouge">UIView</code>s to prevent their color to be
inverted.</em></p>

<p>iOS 11 introduced <code class="highlighter-rouge">accessibilityIgnoresInvertColors</code>, a property on <code class="highlighter-rouge">UIView</code>. From the <a href="https://developer.apple.com/documentation/uikit/uiview/2865843-accessibilityignoresinvertcolors">offical
documentation</a>:</p>

<blockquote>
  <p>If inverting the colors would have a negative impact on your view‚Äôs content, set this property to true to
prevent it from inverting its colors. Setting the property to true prevents the system from inverting the
colors of the view and all of its subviews.</p>
</blockquote>

<p>So, for views containing photos or videos with real-world content, we probably want to set it to <code class="highlighter-rouge">true</code>. In
our sample app‚Äôs source code:</p>

<p><img src="/assets/2017/12/setting-accessibilityIgnoresInvertColors-to-true-in-code.png" alt="setting accessibilityIgnoresInvertColors to true in code" /></p>

<p>This gives us the desired effect for that view üéâ:</p>

<p><img src="/assets/2017/12/smart-invert-in-code-result.png" srcset="/assets/2017/12/smart-invert-in-code-result.png 2x" alt="result of supporting invert color in code" /></p>

<p>The same can be done in Interface Builder. Let‚Äôs fix the other view by setting a runtime attribute:</p>

<p><img src="/assets/2017/12/setting-accessibilityIgnoresInvertColors-to-true-in-interface-builder.png" alt="setting accessibilityIgnoresInvertColors to true in Interface Builder" /></p>

<p>Result:</p>

<p><img src="/assets/2017/12/smart-invert-in-interface-builder-result.png" srcset="/assets/2017/12/smart-invert-in-interface-builder-result.png 2x" alt="result of supporting invert color in interface builder" /></p>

<p>Tada!</p>

<h2 id="compatibility-with-older-ios-versions">Compatibility with older iOS versions</h2>

<p>The story gets slightly complicated when your app need to run on older iOS versions. For one, our code won‚Äôt
compile:</p>

<p><img src="/assets/2017/12/compile-error-on-older-oses.png" alt="compile error on older iOS versions" /></p>

<p>But that‚Äôs nothing new to iOS developers, really. We can fix that with a <code class="highlighter-rouge">#available</code>:</p>

<p><img src="/assets/2017/12/fix-compile-error.png" alt="fix compile error on older iOS versions" /></p>

<p>When you run the app in older iOS devices or simulators, Xcode will complain about our runtime attribute as
well:</p>

<p><img src="/assets/2017/12/xcode-complain-about-runtime-attirbute.png" alt="Xcode complains about runtime attribute on older iOS" /></p>

<p>If that bothers you, I recommend writing your own wrapper for this property as an extension to <code class="highlighter-rouge">UIView</code>. To
put a cherry on top, make it <code class="highlighter-rouge">@IBInspectable</code>!</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">UIView</span> <span class="p">{</span>
    <span class="c1">/// Whether or not to set accessibilityIgnoresInvertColors to true for iOS 11.</span>
    <span class="c1">/// For older OS, this value is false and setting it has no effect.</span>
    <span class="kd">@IBInspectable</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">ignoreColorInversion</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">if</span> <span class="kd">#available(iOS 11, *)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">accessibilityIgnoresInvertColors</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>

        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="kd">#available(iOS 11, *)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">accessibilityIgnoresInvertColors</span> <span class="o">=</span> <span class="n">newValue</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Having this snippet in the project, we set it in interface builder to any view with a couple of clicks:</p>

<p><img src="/assets/2017/12/set-custom-invert-property-in-interface-builder.png" alt="set custom invert color properties in Interface Builder" /></p>

<h2 id="how-to-screenshot-with-inverted-color-settings">How to screenshot with inverted color settings</h2>

<p>Here‚Äôs a bonus hint: screenshots taken on device won‚Äôt have their color inverted even if you have the setting
set to ‚Äúon‚Äù! Go ahead, try it :).</p>

<p>To show off our handy work for supporting smart invert color, we‚Äôll need
some other means to take screenshots. All screenshots in this article is taken using QuickTime on a Mac. So
plug in your iOS device, open QuickTime Player, in menu select <em>File -&gt; New Movie Recording</em> and select your
device from the drop-down menu by clicking the arrow next to the record button:</p>

<p><img src="/assets/2017/12/select-ios-device-in-quicktime-player.png" alt="Select iOS device for screenshots in QuickTime
Player" /></p>

<p>Now you can screen shot the QuickTime Player window the normal way.</p>

<h2 id="conclusion">Conclusion</h2>

<p>You can <a href="/assets/2017/12/SmartInvert.zip">download the sample project</a> and play with it.</p>

<p>Smart invert is awesome and I personally wish all 3rd-party apps will update their apps for it as time goes
on. If your favorite app (including your own!) doesn‚Äôt support it properly, please consider informing the
developer about <a href="https://developer.apple.com/documentation/uikit/uiview/2865843-accessibilityignoresinvertcolors">accessibilityIgnoresInvertColors</a>, or just send this article their way!</p>


  </div>
  <hr />
  


<footer class="masthead">
<h4>Read More:</h4>
<nav class="masthead-nav">
  
  <a href="/articles">articles</a>
  
  <a href="/links">Links</a>
  
  <a href="/projects">Projects</a>
  
  <a href="/about">About</a>
  
</nav>
</footer>

</div>

  </div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)
    },i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-59501714-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
