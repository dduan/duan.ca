<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>Daniel Duan's Articles About Swift,IndexStoreDB</title>
        <link>https://duan.ca/tag/swift-indexstoredb/</link>
        <atom:link href="https://duan.ca/tag/swift-indexstoredb/feed.xml" rel="self" type="application/rss+xml" />
            <item>
                <title>Building IndexStoreDB on Linux: The Portable Technique</title>
                <description>&lt;h2&gt;The problem&lt;&#x2f;h2&gt;
&lt;p&gt;As of writing of this article, when you attempt to use Apple&#x27;s Swift library &lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;apple&#x2f;indexstore-db&quot;&gt;IndexStoreDB&lt;&#x2f;a&gt; on Linux as
a normal SwiftPM dependency, it won&#x27;t build successfully:&lt;&#x2f;p&gt;
&lt;pre&gt;&lt;span class=&quot;source shell bash&quot;&gt;&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;❯&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; cat Package.resolved&lt;&#x2f;span&gt;
&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;{&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
  &lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;&lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;object&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;:&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; &lt;span class=&quot;meta group expansion brace shell&quot;&gt;&lt;span class=&quot;punctuation section expansion brace begin shell&quot;&gt;{&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;pins&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: [
      &lt;span class=&quot;meta group expansion brace shell&quot;&gt;&lt;span class=&quot;punctuation section expansion brace begin shell&quot;&gt;{&lt;&#x2f;span&gt;
        &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;package&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;IndexStoreDB&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
        &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;repositoryURL&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;https:&#x2f;&#x2f;github.com&#x2f;apple&#x2f;indexstore-db&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
        &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;state&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;meta group expansion brace shell&quot;&gt;&lt;span class=&quot;punctuation section expansion brace begin shell&quot;&gt;{&lt;&#x2f;span&gt;
          &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;branch&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;swift-5.5.2-RELEASE&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
          &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;revision&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;e771994778265c2efe8d33a7ca30adf5f3d2065a&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
          &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;version&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: null
        &lt;span class=&quot;punctuation section expansion brace end shell&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
      &lt;span class=&quot;punctuation section expansion brace end shell&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
    ]
  &lt;span class=&quot;punctuation section expansion brace end shell&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;,&lt;&#x2f;span&gt;
  &lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;&lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;version&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;:&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; 1&lt;&#x2f;span&gt;
&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta post-cmd shell&quot;&gt;}
&lt;&#x2f;span&gt;
&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;❯&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; swift build &lt;span class=&quot;keyword operator assignment redirection shell&quot;&gt;&amp;gt;&lt;&#x2f;span&gt; &#x2f;dev&#x2f;null

❯ echo &lt;span class=&quot;meta group expansion parameter shell&quot;&gt;&lt;span class=&quot;punctuation definition variable shell&quot;&gt;$&lt;&#x2f;span&gt;&lt;span class=&quot;variable other readwrite shell&quot;&gt;status&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;1&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;The issue is documented in the build instruction for Linux:&lt;&#x2f;p&gt;
&lt;blockquote&gt;
&lt;p&gt;The C++ code in the index requires &lt;code&gt;libdispatch&lt;&#x2f;code&gt;, but unlike Swift code, it cannot find it automatically on Linux. You can work around this by adding a search path manually.&lt;&#x2f;p&gt;
&lt;&#x2f;blockquote&gt;
&lt;pre&gt;&lt;code&gt;$ swift build -Xcxx -I&amp;lt;path_to_swift_toolchain&amp;gt;&#x2f;usr&#x2f;lib&#x2f;swift -Xcxx -I&amp;lt;path_to_swift_toolchain&amp;gt;&#x2f;usr&#x2f;lib&#x2f;swift&#x2f;Block
&lt;&#x2f;code&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;Okay, so, how would my package build in Linux environments where the Swift toolchain&#x27;s setup is unknown? How
do we avoid building with one toolchain while mixing in &lt;code&gt;libdispatch&lt;&#x2f;code&gt; from another toolchain somewhere? Here&#x27;s
what I did for my command-line tool &lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;dduan&#x2f;Clue&quot;&gt;Clue&lt;&#x2f;a&gt;.&lt;&#x2f;p&gt;
&lt;h2&gt;The solution&lt;&#x2f;h2&gt;
&lt;p&gt;The essence of the problem is about the installation location of the Swift toolchain. Our solution makes the
following assumption&lt;&#x2f;p&gt;
&lt;ol&gt;
&lt;li&gt;A Swift toolchain is installed on the file system on Linux (duh!).&lt;&#x2f;li&gt;
&lt;li&gt;The toolchain is at least similar to the one distributed on Swift.org. So &lt;code&gt;libdispatch&lt;&#x2f;code&gt; is distributed
alongside the other binaries, in a stable relative directory.&lt;&#x2f;li&gt;
&lt;&#x2f;ol&gt;
&lt;p&gt;Having the &lt;code&gt;swift&lt;&#x2f;code&gt; command available (assumption #1), we can just let it tell us about itself with the
&lt;code&gt;-print-target-info&lt;&#x2f;code&gt; flag:&lt;&#x2f;p&gt;
&lt;pre&gt;&lt;span class=&quot;source shell bash&quot;&gt;&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;❯&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; swift&lt;span class=&quot;variable parameter option shell&quot;&gt;&lt;span class=&quot;punctuation definition parameter shell&quot;&gt; -&lt;&#x2f;span&gt;print-target-info&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;{&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
  &lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;&lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;compilerVersion&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;:&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;Swift version 5.5.2 (swift-5.5.2-RELEASE)&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;,&lt;&#x2f;span&gt;
  &lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;&lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;target&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;:&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; &lt;span class=&quot;meta group expansion brace shell&quot;&gt;&lt;span class=&quot;punctuation section expansion brace begin shell&quot;&gt;{&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;triple&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;x86_64-unknown-linux-gnu&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;unversionedTriple&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;x86_64-unknown-linux-gnu&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;moduleTriple&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;x86_64-unknown-linux-gnu&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;compatibilityLibraries&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;keyword control regexp set begin shell&quot;&gt;[&lt;&#x2f;span&gt; &lt;span class=&quot;keyword control regexp set end shell&quot;&gt;]&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;librariesRequireRPath&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: false
  &lt;span class=&quot;punctuation section expansion brace end shell&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;,&lt;&#x2f;span&gt;
  &lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;&lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;paths&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;:&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; &lt;span class=&quot;meta group expansion brace shell&quot;&gt;&lt;span class=&quot;punctuation section expansion brace begin shell&quot;&gt;{&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;runtimeLibraryPaths&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: [
      &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&#x2f;home&#x2f;dan&#x2f;.swiftenv&#x2f;versions&#x2f;5.5.2&#x2f;usr&#x2f;lib&#x2f;swift&#x2f;linux&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
    ]&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;runtimeLibraryImportPaths&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: [
      &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&#x2f;home&#x2f;dan&#x2f;.swiftenv&#x2f;versions&#x2f;5.5.2&#x2f;usr&#x2f;lib&#x2f;swift&#x2f;linux&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
      &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&#x2f;home&#x2f;dan&#x2f;.swiftenv&#x2f;versions&#x2f;5.5.2&#x2f;usr&#x2f;lib&#x2f;swift&#x2f;linux&#x2f;x86_64&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
    ]&lt;span class=&quot;punctuation separator shell&quot;&gt;,&lt;&#x2f;span&gt;
    &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;runtimeResourcePath&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;: &lt;span class=&quot;string quoted double shell&quot;&gt;&lt;span class=&quot;punctuation definition string begin shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&#x2f;home&#x2f;dan&#x2f;.swiftenv&#x2f;versions&#x2f;5.5.2&#x2f;usr&#x2f;lib&#x2f;swift&lt;span class=&quot;punctuation definition string end shell&quot;&gt;&amp;quot;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
  &lt;span class=&quot;punctuation section expansion brace end shell&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta post-cmd shell&quot;&gt;}
&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;Great! We see where the runtime is installed. Now we can invoke assumption #2, that &lt;code&gt;libdispatch&lt;&#x2f;code&gt; is at
a relative location to the rest of the runtime. In the output from above, the value for &lt;code&gt;runtimeResourcePath&lt;&#x2f;code&gt;
happens to be the parent directory for &lt;code&gt;libdispatch&lt;&#x2f;code&gt;&#x27;s headers. The &lt;code&gt;&amp;lt;path_to_swift_toolchain&amp;gt;&lt;&#x2f;code&gt; value in
&lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;apple&#x2f;indexstore-db&quot;&gt;IndexStoreDB&lt;&#x2f;a&gt;&#x27;s official instruction in this particular setup would be
&lt;code&gt;&#x2f;home&#x2f;dan&#x2f;.swiftenv&#x2f;versions&#x2f;5.5.2&lt;&#x2f;code&gt;.  So the following command would have worked:&lt;&#x2f;p&gt;
&lt;pre&gt;&lt;code&gt;swift build -Xcxx -I&#x2f;home&#x2f;dan&#x2f;.swiftenv&#x2f;versions&#x2f;5.5.2&#x2f;usr&#x2f;lib&#x2f;swift -Xcxx -I&#x2f;home&#x2f;dan&#x2f;.swiftenv&#x2f;versions&#x2f;5.5.2&#x2f;usr&#x2f;lib&#x2f;swift&#x2f;Block
&lt;&#x2f;code&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;All we need to do is parse this information at build time, and it should work on every Linux setup! Choose
whatever parsing method you like. Here&#x27;s (more or less) the &lt;code&gt;Makefile&lt;&#x2f;code&gt; for &lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;dduan&#x2f;Clue&quot;&gt;Clue&lt;&#x2f;a&gt;:&lt;&#x2f;p&gt;
&lt;pre&gt;&lt;span class=&quot;source makefile&quot;&gt;&lt;span class=&quot;variable other makefile&quot;&gt;SHELL&lt;&#x2f;span&gt; &lt;span class=&quot;keyword operator assignment makefile&quot;&gt;=&lt;&#x2f;span&gt; &lt;span class=&quot;string unquoted makefile&quot;&gt;&#x2f;bin&#x2f;bash&lt;&#x2f;span&gt;
&lt;span class=&quot;meta group makefile&quot;&gt;&lt;span class=&quot;keyword control conditional makefile&quot;&gt;ifeq&lt;&#x2f;span&gt; &lt;span class=&quot;punctuation section group begin makefile&quot;&gt;(&lt;&#x2f;span&gt;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;$(&lt;&#x2f;span&gt;&lt;span class=&quot;support function builtin makefile&quot;&gt;shell&lt;&#x2f;span&gt; &lt;span class=&quot;source shell&quot;&gt;&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;uname&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;keyword other block end makefile&quot;&gt;)&lt;&#x2f;span&gt;&lt;span class=&quot;punctuation separator makefile&quot;&gt;,&lt;&#x2f;span&gt;Darwin&lt;span class=&quot;punctuation section group end makefile&quot;&gt;)&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
&lt;span class=&quot;variable other makefile&quot;&gt;EXTRA_SWIFT_FLAGS&lt;&#x2f;span&gt; &lt;span class=&quot;keyword operator assignment makefile&quot;&gt;=&lt;&#x2f;span&gt; &lt;span class=&quot;string unquoted makefile&quot;&gt;&amp;quot;--disable-sandbox&amp;quot;&lt;&#x2f;span&gt;
&lt;span class=&quot;keyword control conditional makefile&quot;&gt;else&lt;&#x2f;span&gt;
&lt;span class=&quot;variable other makefile&quot;&gt;SWIFT_TOOLCHAIN&lt;&#x2f;span&gt; &lt;span class=&quot;keyword operator assignment makefile&quot;&gt;=&lt;&#x2f;span&gt; &lt;span class=&quot;string unquoted makefile&quot;&gt;&amp;quot;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;$(&lt;&#x2f;span&gt;&lt;span class=&quot;support function builtin makefile&quot;&gt;shell&lt;&#x2f;span&gt; &lt;span class=&quot;source shell&quot;&gt;&lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;swift&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt;&lt;span class=&quot;variable parameter option shell&quot;&gt;&lt;span class=&quot;punctuation definition parameter shell&quot;&gt; -&lt;&#x2f;span&gt;print-target-info&lt;&#x2f;span&gt;&lt;&#x2f;span&gt; &lt;span class=&quot;keyword operator logical pipe shell&quot;&gt;|&lt;&#x2f;span&gt; &lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;grep&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt; runtimeResourcePath&lt;&#x2f;span&gt; &lt;span class=&quot;keyword operator logical pipe shell&quot;&gt;|&lt;&#x2f;span&gt; &lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;cut&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt;&lt;span class=&quot;variable parameter option shell&quot;&gt;&lt;span class=&quot;punctuation definition parameter shell&quot;&gt; -&lt;&#x2f;span&gt;f&lt;&#x2f;span&gt; 2&lt;span class=&quot;variable parameter option shell&quot;&gt;&lt;span class=&quot;punctuation definition parameter shell&quot;&gt; -&lt;&#x2f;span&gt;d&lt;&#x2f;span&gt; &lt;span class=&quot;string quoted single makefile&quot;&gt;&lt;span class=&quot;punctuation definition string begin makefile&quot;&gt;&amp;#39;&lt;&#x2f;span&gt;:&lt;span class=&quot;punctuation definition string end makefile&quot;&gt;&amp;#39;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt; &lt;span class=&quot;keyword operator logical pipe shell&quot;&gt;|&lt;&#x2f;span&gt; &lt;span class=&quot;meta function-call shell&quot;&gt;&lt;span class=&quot;variable function shell&quot;&gt;cut&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments shell&quot;&gt;&lt;span class=&quot;variable parameter option shell&quot;&gt;&lt;span class=&quot;punctuation definition parameter shell&quot;&gt; -&lt;&#x2f;span&gt;f&lt;&#x2f;span&gt; 2&lt;span class=&quot;variable parameter option shell&quot;&gt;&lt;span class=&quot;punctuation definition parameter shell&quot;&gt; -&lt;&#x2f;span&gt;d&lt;&#x2f;span&gt; &lt;span class=&quot;string quoted single makefile&quot;&gt;&lt;span class=&quot;punctuation definition string begin makefile&quot;&gt;&amp;#39;&lt;&#x2f;span&gt;&amp;quot;&lt;span class=&quot;punctuation definition string end makefile&quot;&gt;&amp;#39;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;keyword other block end makefile&quot;&gt;)&lt;&#x2f;span&gt;&amp;quot;&lt;&#x2f;span&gt;
&lt;span class=&quot;variable other makefile&quot;&gt;EXTRA_SWIFT_FLAGS&lt;&#x2f;span&gt; &lt;span class=&quot;keyword operator assignment makefile&quot;&gt;=&lt;&#x2f;span&gt; &lt;span class=&quot;string unquoted makefile&quot;&gt;-Xcxx -I&lt;span class=&quot;variable parameter makefile&quot;&gt;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;${&lt;&#x2f;span&gt;SWIFT_TOOLCHAIN&lt;span class=&quot;keyword other block end makefile&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt; -Xcxx -I&lt;span class=&quot;variable parameter makefile&quot;&gt;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;${&lt;&#x2f;span&gt;SWIFT_TOOLCHAIN&lt;span class=&quot;keyword other block end makefile&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&#x2f;Block&lt;&#x2f;span&gt;
&lt;span class=&quot;keyword control conditional makefile&quot;&gt;endif&lt;&#x2f;span&gt;

&lt;span class=&quot;keyword control makefile&quot;&gt;define&lt;&#x2f;span&gt;&lt;span class=&quot;variable other makefile&quot;&gt; build
	@swift build --configuration &lt;span class=&quot;variable parameter makefile&quot;&gt;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;$(&lt;&#x2f;span&gt;1&lt;span class=&quot;keyword other block end makefile&quot;&gt;)&lt;&#x2f;span&gt;&lt;&#x2f;span&gt; -Xswiftc -warnings-as-errors &lt;span class=&quot;variable parameter makefile&quot;&gt;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;${&lt;&#x2f;span&gt;EXTRA_SWIFT_FLAGS&lt;span class=&quot;keyword other block end makefile&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;
endef

.PHONY: build
build:
	&lt;span class=&quot;meta function-call makefile&quot;&gt;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;$(&lt;&#x2f;span&gt;&lt;span class=&quot;constant language call makefile&quot;&gt;call&lt;&#x2f;span&gt; &lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call makefile&quot;&gt;&lt;span class=&quot;variable function makefile&quot;&gt;build&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call makefile&quot;&gt;&lt;span class=&quot;punctuation separator makefile&quot;&gt;,&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments makefile&quot;&gt;release&lt;&#x2f;span&gt;&lt;span class=&quot;keyword other block end makefile&quot;&gt;)&lt;&#x2f;span&gt;

.PHONY: test
test:
	@swift test &lt;span class=&quot;variable parameter makefile&quot;&gt;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;${&lt;&#x2f;span&gt;EXTRA_SWIFT_FLAGS&lt;span class=&quot;keyword other block end makefile&quot;&gt;}&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;

.PHONY: debug
debug:
	&lt;span class=&quot;meta function-call makefile&quot;&gt;&lt;span class=&quot;keyword other block begin makefile&quot;&gt;$(&lt;&#x2f;span&gt;&lt;span class=&quot;constant language call makefile&quot;&gt;call&lt;&#x2f;span&gt; &lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call makefile&quot;&gt;&lt;span class=&quot;variable function makefile&quot;&gt;build&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call makefile&quot;&gt;&lt;span class=&quot;punctuation separator makefile&quot;&gt;,&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;span class=&quot;meta function-call arguments makefile&quot;&gt;debug&lt;&#x2f;span&gt;&lt;span class=&quot;keyword other block end makefile&quot;&gt;)&lt;&#x2f;span&gt;
&lt;&#x2f;span&gt;&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;make build&lt;&#x2f;code&gt; &#x2f; &lt;code&gt;make test&lt;&#x2f;code&gt; &#x2f; &lt;code&gt;make debug&lt;&#x2f;code&gt; all work as expected, building IndexStoreDB successfully.&lt;&#x2f;li&gt;
&lt;li&gt;As-is, this snippet is project-agnostic. So you can throw it in your SwiftPM project and it should &amp;quot;just
work&amp;quot;.&lt;&#x2f;li&gt;
&lt;&#x2f;ol&gt;
&lt;p&gt;Alright!&lt;&#x2f;p&gt;
</description>
                <pubDate>Wed, 09 Feb 2022 15:58:41 -0800</pubDate>
                <link>https://duan.ca/2022/02/09/building-indexstoredb-on-linux/</link>
                <guid isPermaLink="true">https://duan.ca/2022/02/09/building-indexstoredb-on-linux/</guid>
            </item>
    </channel>
</rss>